// dom.js
// In this file, students will write the functions that update the DOM.
// This file is responsible for changing what the user sees on the screen

// Useful DOM APIs to reference:
// - document.createElement: https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement
// - Element.appendChild: https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild
// - document.querySelector: https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector
// - HTMLInputElement: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input
// - HTMLElement.focus(): https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus
// - Element.setAttribute(): https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute
// - Element.classList: https://developer.mozilla.org/en-US/docs/Web/API/Element/classList

/*
EXPECTED HTML STRUCTURE FOR EACH TASK ITEM
------------------------------------------
The functions below should produce elements that match this structure:

<li class="task-item" data-id="TASK_ID_HERE">
  <div class="task-item-left">
    <input type="checkbox" class="task-checkbox" />

    <div class="task-main">
      <p class="task-title">TASK TITLE</p>

      <!-- Only show this if category or due date exist -->
      <p class="task-meta">CATEGORY • DUE_DATE</p>
    </div>
  </div>

  <div class="task-actions">
    <button type="button" class="task-delete-button">Delete</button>
  </div>
</li>

Make sure your generated elements follow this structure
and use these same CSS classes.
*/


/*
EXPECTED OUTPUT OF renderTasks():
--------------------------------

<ul id="task-list">
  <!-- If there are tasks, this list will contain several <li> elements
       each generated by createTaskElement() -->

  <!-- If there are NO tasks:
       - The list should be empty
       - The "empty state" message should be visible -->
</ul>

<p id="empty-state">No tasks yet. Add your first task above!</p>
*/

// This function should:
// - Clear the current task list
// - Loop through the tasks array
// - Create an <li> for each task using createTaskElement()
// - Add each <li> to the <ul>
// - Show the empty state message when there are no tasks


function renderTasks(tasks, listElement, emptyStateElement) {
  
  // Remove everything currently inside the <ul>
  // This prevents duplicate tasks from appearing
  listElement.innerHTML = "";

  // If thereare no tasks in the array
  if (tasks.length === 0) {

    // Show the "no tasks yet" message
    emptyStateElement.style.display = "block";

    return ;
  }

  // If the tasks DO exist, hide the empty message
  emptyStateElement.style.display = "none";

  // Loop through every task in the tasks array
  tasks.forEach(task => { //tasks.forEach is not defined here, fix it

    // Create one <li> element for this task
    const taskElement = createTaskElement(task);

    // Add the <li> to the <ul> on the page
    listElement.appendChild(taskElement);
  });
}


// This function should:
// - Create and return ONE <li> element following the structure above
// - Contain the checkbox, title, optional meta info, and delete button
// - Add the correct classes to each element
// - Make the checkbox checked if the task is completed
// - NOT add event listeners (app.js will handle that)
function createTaskElement(task) {
  
  // Create the <li> element
  const listItem = document.createElement("li");

  // Add the CSS class used for styling
  listItem.classList.add("task-item");

  // Storing the tasks's unique ID inside the HTML element
  listItem.dataset.id = task.id;

  // Store the task ID in the HTML so app.js can read it later
  listItem.setAttribute("data-id", task.id);


  // Creating the left side container
  const leftDiv = document.createElement("div");
  leftDiv.classList.add("task-item-left");

  // Creating the checkbox
  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.classList.add("task-checkbox");

  // If the task is completed, check the checkbox
  checkbox.checked = task.completed;

  // Creating the main text container
  const mainDiv = document.createElement("div");
  mainDiv.classList.add("task-main");

  // Creating the task title
  const title = document.createElement("p");
  title.classList.add("task-title");
  title.textContent = task.title;

  // Add the title to the main content area
  mainDiv.appendChild(title);

  // Only create meta information if category or due date exists
  if (task.category || task.dueDate) {

    const meta = document.createElement("p");
    meta.classList.add("task-meta");

    // Build the meta text
    let metaText = "";

    if (task.category) {
      metaText += task.category;
    }

    if (task.category && task.dueDate) {
      metaText += " • ";
    }

    if (task.dueDate) {
      metaText += task.dueDate;
    }
    
    // Add meta info under the title
    meta.textContent = metaText;
    mainDiv.appendChild(meta);
  }

  // Put checkbox and text together
  leftDiv.appendChild(checkbox);
  leftDiv.appendChild(mainDiv);

  // Actions
  const actionsDiv = document.createElement("div");
  actionsDiv.classList.add("task-actions");

  const deleteButton = document.createElement("button");
  deleteButton.type = "button";
  deleteButton.classList.add("task-delete-button");
  deleteButton.textContent = "Delete";

  // Add delete button to actions
  actionsDiv.appendChild(deleteButton);

  // Final Assembly
  listItem.appendChild(leftDiv);
  listItem.appendChild(actionsDiv);

  // Return the finished <li>
  return listItem;
}



// This function should:
// - Reset the form
// - Put focus back on the task title input
function clearTaskForm(form) {
  
  // Reset all form fields to empty
  form.reset();

  // Fnd the title input inside the form
  const titleInput = form.querySelector("input");

  // Put the typinf cursor back in the title box
  titleInput.focus();
}
